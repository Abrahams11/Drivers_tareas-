/**
 ******************************************************************************
 * @file           : main.c
 * @author         : Auto-generated by STM32CubeIDE
 * @brief          : Main program body
 ******************************************************************************
 * @attention
 *
 * Copyright (c) 2022 STMicroelectronics.
 * All rights reserved.
 *
 * This software is licensed under terms that can be found in the LICENSE file
 * in the root directory of this software component.
 * If no LICENSE file comes with this software, it is provided AS-IS.
 *
 ******************************************************************************
 */

#include <stdint.h>
#include "GPIOx.h"
#include "RCC.h"
#include "SYSTICK.h"
#include "NVIC.h"

#include "CANx.h"

int main(void)
{
	CAN_FilterTypeDef FLTR[14];
	CAN_Handler can;
	CAN_BitTimingTypeDef tq;
	can.Register=CAN1;
	//Los prescaladores se seleccionan por n=1,2,...,8. Siendo 2^n el valor del preescalador
	SystClock_Init(2,0,80,0,0,0);//SYSCLK -> PLLP, SYSPLL -> HSI, SYSCLK -> 80MHz, preAHB1 -> divided by 2^0
	//preAPB1 -> Not divided, preAPB2 -> not divided, APB1 = 40MHZ, APB2=80MHz.
	NVIC_SetCFGR(30, 3);

	FLTR[0].indexFltr=10;
	FLTR[1].indexFltr=11;
	FLTR[2].indexFltr=12;

	tq.ntq = 16;//16 time quantum
	tq.kbps = 1000;//1Mbps
	tq.SJW = 0;

	CANx_Init(&can, FLTR, &tq, false, 0, 3);//can struct; array of sturct FLTR; tq struct; false->No dual mode; 0->SJW=0; 3->Number of filters to configure

    /* Loop forever */
	for(;;);
}
